<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forecast Job Status</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container py-5">
    <h1>Forecast Job Status</h1>
    <div id="status" class="mt-3"></div>
    <button id="cancel-btn" class="btn btn-warning mt-3">Cancel Job</button>
    <script>
        const jobId = "{{ job_id }}";
        document.getElementById('cancel-btn').onclick = async function() {
            this.disabled = true;
            document.getElementById('status').innerHTML = '<div>Cancellation requested...</div>';
            await fetch(`/cancel/${jobId}`, {method: 'POST'});
        };
        async function pollStatus() {
            while (true) {
                const resp = await fetch(`/status/${jobId}`);
                const data = await resp.json();
                let logBlock = '';
                if (Array.isArray(data.log) && data.log.length > 0) {
                    logBlock = '<div>' + data.log[data.log.length - 1] + '</div>';
                } else {
                    logBlock = '<div>Job submitted. Waiting for status...</div>';
                }
                document.getElementById('status').innerHTML = logBlock;
                if (["completed","failed","stopped"].includes(data.status)) {
                    document.getElementById('cancel-btn').disabled = true;
                    break;
                }
                await new Promise(r => setTimeout(r, 2000));
            }
        }
        pollStatus();
    </script>
    <a href="/" class="btn btn-secondary mt-3">Back to Home</a>
</body>
</html>
